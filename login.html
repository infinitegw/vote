<!DOCTYPE html>
<html>
<head>
  <title>Vote</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="logo.png">
</head>
<body onload="checkLoginAndLoadCandidates()">
  <div class="container">
    <h2>üó≥Ô∏è Cast Your Vote</h2>
    <p id="welcome"></p>

    <select id="post" onchange="loadCandidates()">
      <option disabled selected>Select Post</option>
    </select>

    <div id="candidates"></div>

    <button onclick="logout()">üö™ Logout</button>
    <p><a href="dashboard.html">‚¨Ö Back to Dashboard</a></p>
  </div>

  <script src="script.js"></script>
  <script>
    function checkLoginAndLoadCandidates() {
      const currentStudent = JSON.parse(localStorage.getItem("currentStudent"));
      if (!currentStudent) {
        alert("You must log in first!");
        window.location.href = "login.html";
        return;
      }

      document.getElementById("welcome").innerText = 
        "Welcome, " + currentStudent.name + " (" + currentStudent.adm + ")";

      // Load posts from localStorage (set by admin)
      const posts = JSON.parse(localStorage.getItem("posts")) || [];
      document.getElementById("post").innerHTML =
        `<option disabled selected>Select Post</option>` +
        posts.map(p => `<option>${p}</option>`).join("");
    }

    function loadCandidates() {
      const post = document.getElementById("post").value;
      const candidates = JSON.parse(localStorage.getItem("candidates")) || [];
      const filtered = candidates.filter(c => c.post === post && c.approved);

      let html = "";
      if (filtered.length === 0) {
        html = "<p>No candidates available for this post.</p>";
      } else {
        html = filtered.map(c => `
          <div class="card">
            <h3>${c.name}</h3>
            <p><b>Dorm:</b> ${c.dorm} | <b>Class:</b> ${c.class}</p>
            <button onclick="castVote('${post}', '${c.name}')">Vote</button>
          </div>
        `).join("");
      }
      document.getElementById("candidates").innerHTML = html;
    }
  </script>
</body>
</html>
